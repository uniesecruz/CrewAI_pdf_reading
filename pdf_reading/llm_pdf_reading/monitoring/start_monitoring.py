#!/usr/bin/env python3
"""
Script para iniciar o sistema de monitoramento
Execute este script no in√≠cio da sua aplica√ß√£o
"""

import sys
from pathlib import Path

# Adicionar path do projeto
project_root = Path(__file__).parent.parent.parent
sys.path.insert(0, str(project_root))

from llm_pdf_reading.monitoring import model_monitor, experiment_manager

def start_monitoring():
    """Inicia o sistema de monitoramento"""
    print("üöÄ Iniciando sistema de monitoramento...")
    
    # Configurar alertas
    def on_high_response_time(model_name: str, response_time: float):
        print(f"‚ö†Ô∏è ALERTA: {model_name} - Tempo alto: {response_time:.2f}s")
    
    def on_model_error(model_name: str, error: str):
        print(f"‚ùå ERRO: {model_name} - {error}")
    
    # Registrar callbacks
    model_monitor.add_alert_callback("high_response_time", on_high_response_time)
    model_monitor.add_alert_callback("model_error", on_model_error)
    
    # Iniciar monitoramento
    model_monitor.start_monitoring()
    print("‚úÖ Monitoramento de modelos iniciado")
    
    # Iniciar sess√£o MLflow (se dispon√≠vel)
    if experiment_manager.mlflow_available:
        run_id = experiment_manager.start_run(
            run_name="monitoring_session",
            tags={
                "project": "llm_pdf_reading",
                "environment": "development",
                "auto_started": "true"
            }
        )
        print(f"üìä Sess√£o MLflow iniciada: {run_id}")
    
    print("üéØ Sistema de monitoramento pronto!")
    return True

if __name__ == "__main__":
    start_monitoring()
